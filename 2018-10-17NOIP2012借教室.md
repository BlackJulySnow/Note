---
title: 2018-10-17NOIP2012借教室
tags: 线段树,差分,前缀和
grammar_cjkRuby: true
---
[link](https://www.luogu.org/problemnew/show/P1083)

这道题有两种做法，

### 一种比较简单的做法是二分，但是考场比较难想到
### 另一种思路比较明显，但是要想到也不容易，就是线段树

 1. 差分思路

***证明：***

> 在一个订单的起始天+要借的房间数量，在结束天的下一天减去要借的房间数量。设一个数组c[i]，记录前缀和。读入的数据是d,s,t
> 
> c[s]:=c[s]+d;c[t+1]:=c[t+1]-d;
> 
> 那么如果第i天在s和t之间，那么前i天的sum{c[i]}中有c[s],相当于已经记下第i天的订单数量了。如果第i天在t之后，前i天的sum{c[i]}中有c[s]和c[t],因为c[s]+d+c[t+1]-d=c[s]+c[t]，所以这个订单只对s和t中间天数起作用。得证！

```cpp
bool check(int mid)  //判断当前的二分值是否可行  
{
    int i, sum = 0;
    if(now > mid) 
      for(i = mid + 1; i <= now; i++) {
          c[s[i]] -= d[i];
          c[t[i] + 1] += d[i];
      }
    else
      for(i = now + 1; i <= mid; i++) {  //注意这里是将以前操作的恢复原样，操作相反
          c[s[i]] += d[i];
          c[t[i] + 1] -= d[i];
      }
    now = mid;
    for(i = 1; i <= n; i++) {
      sum += c[i];
      if(sum > r[i]) return true;
    }
    return false;
}
```